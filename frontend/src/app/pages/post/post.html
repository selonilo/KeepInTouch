<p-toolbar *ngIf="!isProfilePage" styleClass="mb-6">
    <ng-template #start>
        <p-button label="Ekle" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
    </ng-template>

    <ng-template #end>
        <p-button label="Dışa Aktar" icon="pi pi-upload" severity="secondary" (onClick)="exportCSV()" />
    </ng-template>
</p-toolbar>

<div class="card">
    <div class="font-semibold text-xl">Gönderiler</div>
    <p-dataview [value]="tableList" [layout]="'grid'">

        <ng-template #grid let-items>
            <div class="grid grid-cols-12 gap-4">
                <div *ngFor="let item of items; let i = index" class="col-span-12 sm:col-span-6 lg:col-span-4 p-2">
                    <span class="font-medium text-surface-500 dark:text-surface-400">{{
                        item.title }}</span>
                    <div
                        class="p-6 border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 rounded flex flex-col">
                        <div class="bg-surface-50 flex justify-center rounded p-6">
                            <div class="relative mx-auto">
                                <img *ngIf="item.imageUrl" class="rounded w-full" [src]="filePath + item.imageUrl"
                                    style="max-width: 300px" />
                                <img *ngIf="!item.imageUrl" class="rounded w-full" src="assets/logo/notfound.png"
                                    style="max-width: 300px" />
                            </div>
                        </div>
                        <div class="pt-12">
                            <div style="margin-bottom: 2rem;">
                                <p-chip *ngIf="item.userImageUrl" [label]="item.name" class="chip-pointer"
                                    [image]="filePath + item.userImageUrl" styleClass="m-1"
                                    (click)="routeProfile(item.userId)"></p-chip>
                                <p-chip *ngIf="!item.userImageUrl" [label]="item.name" class="chip-pointer"
                                    icon="pi pi-user" (click)="routeProfile(item.userId)" styleClass="m-1"></p-chip>
                            </div>
                            <div class="flex flex-row justify-between items-start gap-2 w-full flex-wrap">
                                <div class="min-w-0 flex-1">
                                    <span class="font-medium text-surface-500 dark:text-surface-400 text-sm">
                                        {{ item.postType }}
                                    </span>
                                    <div class="mt-1">
                                        <div class="text-lg font-medium break-words whitespace-pre-wrap">
                                            {{ item.content }}
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-surface-100 p-1 shrink-0" style="border-radius: 30px">
                                    <div class="bg-surface-0 flex items-center gap-2 justify-center py-1 px-2" style="
                                            border-radius: 30px;
                                            box-shadow:
                                                0px 1px 2px 0px rgba(0, 0, 0, 0.04),
                                                0px 1px 2px 0px rgba(0, 0, 0, 0.06);
                                        ">
                                        <span class="text-surface-900 font-medium text-sm">{{ item.viewNumber }}</span>
                                        <i class="pi pi-eye text-yellow-500"></i>
                                        <span class="text-surface-900 font-medium text-sm">{{ item.likeNumber }}</span>
                                        <i class="pi pi-heart-fill text-red-500"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col gap-6 mt-6">
                                <div class="flex gap-2">
                                    <p-button *ngIf="!item.isLiked" icon="pi pi-heart" styleClass="h-full"
                                        [outlined]="true" (onClick)="likePost(item)"></p-button>
                                    <p-button *ngIf="item.isLiked" icon="pi pi-heart-fill" styleClass="h-full"
                                        [outlined]="true" (onClick)="unLikePost(item)"></p-button>
                                    <p-button *ngIf="userId === item.userId" icon="pi pi-pencil" [rounded]="true"
                                        [outlined]="true" (click)="edit(item)"></p-button>
                                    <p-button *ngIf="userId === item.userId" icon="pi pi-trash" severity="danger"
                                        [rounded]="true" [outlined]="true" (click)="delete(item)" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>
    </p-dataview>
</div>

<p-dialog [(visible)]="formDialog" [style]="{ width: '450px' }" header="Gönderi Detayı" [modal]="true">
    <ng-template #content>
        <div class="flex flex-col gap-6">
            <div *ngIf="!selectedItem.imageUrl" class="col-span-full lg:col-span-6">
                <div class="card">
                    <div class="font-semibold text-xl mb-4">Advanced</div>
                    <p-fileUpload #uploader name="file" [customUpload]="true" (uploadHandler)="onUpload($event)"
                        accept="image/*" maxFileSize="1000000" chooseLabel="Dosya Seç">
                    </p-fileUpload>
                </div>
            </div>
            <div class="avatar-container">
                <p-avatar *ngIf="selectedItem.imageUrl" class="custom-avatar" [image]="filePath + selectedItem.imageUrl" size="xlarge"
                    shape="circle"></p-avatar>
                <p-button *ngIf="selectedItem.imageUrl" (onClick)="onDeleteImage()" label="Resmi Sil"></p-button>
            </div>
            <div>
                <label for="title" class="block font-bold mb-3">Başlık</label>
                <input type="text" pInputText id="title" [(ngModel)]="selectedItem.title" required autofocus fluid />
                <small class="text-red-500" *ngIf="submitted && !selectedItem.title">Boş olamaz.</small>
            </div>
            <div>
                <label for="content" class="block font-bold mb-3">İçerik</label>
                <input type="text" pInputText id="name" [(ngModel)]="selectedItem.content" required autofocus fluid />
                <small class="text-red-500" *ngIf="submitted && !selectedItem.content">Boş olamaz.</small>
            </div>
            <div>
                <label for="postType" class="block font-bold mb-3">Gönderi Türü</label>
                <p-select [(ngModel)]="selectedItem.postType" inputId="postType" [options]="postTypeList"
                    placeholder="Seçiniz" appendTo="body" fluid />
                <small class="text-red-500" *ngIf="submitted && !selectedItem.postType">Boş olamaz.</small>
            </div>
        </div>
    </ng-template>

    <ng-template #footer>
        <p-button label="Vazgeç" icon="pi pi-times" text (click)="hideDialog()" />
        <p-button label="Kaydet" icon="pi pi-check" (click)="save()" />
    </ng-template>
</p-dialog>

<p-confirmdialog [style]="{ width: '450px' }" />
<p-toast />